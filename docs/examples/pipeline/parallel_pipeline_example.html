
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Parallel Pipeline Example &#8212; Iguanas  documentation</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/iguanas.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../../_static/iguanas_icon.png"/>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Rules-Based System (RBS)" href="../rbs/index.html" />
    <link rel="prev" title="Linear Pipeline Example" href="linear_pipeline_example.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/iguanas_text_logo.png" class="logo" alt="logo">
</a>      


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../install/index.html">
  Installation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../user_guide/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../api/index.html">
  API
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../about_the_project/index.html">
  About the project
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/paypal/Iguanas" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../complete/index.html">
   Complete examples
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../complete/rbs_example.html">
     Rules-Based System (RBS) example
    </a>
   </li>
  </ul>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../correlation_reduction/index.html">
   Correlation Reduction
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../correlation_reduction/agglomerative_clustering_reducer_example.html">
     AgglomerativeClusteringReducer Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../metrics/index.html">
   Metrics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../metrics/classification_example.html">
     Classification Metrics Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../metrics/classification_spark_example.html">
     Classification Metrics Spark Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../metrics/pairwise_example.html">
     Pairwise Metrics Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../metrics/unsupervised_example.html">
     Unsupervised Metrics Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../metrics/unsupervised_spark_example.html">
     Unsupervised Metrics Spark Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Pipeline
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="linear_pipeline_example.html">
     Linear Pipeline Example
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Parallel Pipeline Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rbs/index.html">
   Rules-Based System (RBS)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rbs/rbs_pipeline_example.html">
     Rule-Based System (RBS) Pipeline Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rbs/rbs_optimiser_example.html">
     Rule-Based System (RBS) Optimiser Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rule_application/index.html">
   Rule Application
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_application/rule_applier_example.html">
     Rule Applier Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_application/rule_applier_spark_example.html">
     Rule Applier Spark Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rule_generation/index.html">
   Rule Generation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_generation/rule_generator_dt_example.html">
     Rule Generator (Decision Tree algorithm) Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_generation/rule_generator_dt_spark_example.html">
     Rule Generator (Decision Tree algorithm) Spark Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_generation/rule_generator_opt_example.html">
     Rule Generator (Optimisation algorithm) Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rule_optimisation/index.html">
   Rule Optimisation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_optimisation/bayesian_optimiser_example.html">
     Bayesian Optimiser Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_optimisation/bayesian_optimiser_unlabelled_example.html">
     Bayesian Optimiser (unlabelled) Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_optimisation/direct_search_optimiser_example.html">
     Direct Search Optimiser Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_optimisation/direct_search_optimiser_unlabelled_example.html">
     Direct Search Optimiser (unlabelled) Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rule_scoring/index.html">
   Rule Scoring
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_scoring/rule_scorer_example.html">
     Rule Scorer Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rule_selection/index.html">
   Rule Selection
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_selection/simple_filter_example.html">
     Simple Filter Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_selection/correlated_filter_example.html">
     Correlated Filter Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_selection/greedy_filter_example.html">
     Greedy Filter Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_selection/bayes_search_cv_example.html">
     Bayes Search CV Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rule_selection/advanced_bayes_search_cv_example.html">
     Advanced Bayes Search CV Example
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../rules/index.html">
   Rules
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
  <label for="toctree-checkbox-11">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../rules/rules_example.html">
     Rules Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../rules/convert_processed_conditions_to_general_example.html">
     Convert Processed Conditions to General Example
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Import-packages">
   Import packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Read-in-data">
   Read in data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Data-processing">
   Data processing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Set-up-pipeline">
   Set up pipeline
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Using-the-pipeline">
   Using the pipeline
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fit-method">
     <code class="docutils literal notranslate">
      <span class="pre">
       fit
      </span>
     </code>
     method
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#Outputs">
       Outputs
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fit_predict-method">
     <code class="docutils literal notranslate">
      <span class="pre">
       fit_predict
      </span>
     </code>
     method
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Outputs
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predict-method">
     <code class="docutils literal notranslate">
      <span class="pre">
       predict
      </span>
     </code>
     method
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Outputs
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Parallel-Pipeline-Example">
<h1>Parallel Pipeline Example<a class="headerlink" href="#Parallel-Pipeline-Example" title="Permalink to this headline">¶</a></h1>
<p>A Parallel Pipeline is a set of steps which run independently - their outputs are then combined and returned. Each step should be an instantiated class with both <code class="docutils literal notranslate"><span class="pre">fit</span></code> and <code class="docutils literal notranslate"><span class="pre">transform</span></code> methods.</p>
<p>The below diagram shows the high level structure of a Parallel Pipeline:</p>
<center><p><img alt="590f7795f14a4f2096e4a6979a06c954" src="../../_images/parallel_pipeline_structure.png" /></p>
</center><p>It is used to carry out multiple processes seperately and combine their outputs. One such use case is when we want to both:</p>
<ol class="arabic simple">
<li><p>Generate a new rule set, and:</p></li>
<li><p>Optimise an existing rule set, then:</p></li>
<li><p>Use the combined rule sets to optimise a decision engine</p></li>
</ol>
<p>An example of this workflow is shown below:</p>
<center><p><img alt="9b3ecae59dd54e0692b25f4698c28821" src="../../_images/parallel_pipeline_example.png" /></p>
</center><p>To create this workflow in Iguanas, the rule generation and rule optimisation steps are added to a Parallel Pipeline, so they run separately and their outputs are combined. This Parallel Pipeline is then added to a Linear Pipeline, along with the decision engine optimisation step, so that the output of the Parallel Pipeline is fed into the decision engine optimiser.</p>
<p><strong>We’ll see how this workflow can be generated in the following example.</strong></p>
<hr class="docutils" />
<section id="Import-packages">
<h2>Import packages<a class="headerlink" href="#Import-packages" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">iguanas.rule_generation</span> <span class="kn">import</span> <span class="n">RuleGeneratorDT</span>
<span class="kn">from</span> <span class="nn">iguanas.rule_optimisation</span> <span class="kn">import</span> <span class="n">BayesianOptimiser</span>
<span class="kn">from</span> <span class="nn">iguanas.rule_selection</span> <span class="kn">import</span> <span class="n">SimpleFilter</span><span class="p">,</span> <span class="n">CorrelatedFilter</span>
<span class="kn">from</span> <span class="nn">iguanas.metrics</span> <span class="kn">import</span> <span class="n">FScore</span><span class="p">,</span> <span class="n">Precision</span><span class="p">,</span> <span class="n">JaccardSimilarity</span>
<span class="kn">from</span> <span class="nn">iguanas.rbs</span> <span class="kn">import</span> <span class="n">RBSOptimiser</span><span class="p">,</span> <span class="n">RBSPipeline</span>
<span class="kn">from</span> <span class="nn">iguanas.correlation_reduction</span> <span class="kn">import</span> <span class="n">AgglomerativeClusteringReducer</span>
<span class="kn">from</span> <span class="nn">iguanas.pipeline</span> <span class="kn">import</span> <span class="n">LinearPipeline</span><span class="p">,</span> <span class="n">ParallelPipeline</span><span class="p">,</span> <span class="n">ClassAccessor</span>
<span class="kn">from</span> <span class="nn">iguanas.rules</span> <span class="kn">import</span> <span class="n">Rules</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">category_encoders.one_hot</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
</pre></div>
</div>
</div>
</section>
<section id="Read-in-data">
<h2>Read in data<a class="headerlink" href="#Read-in-data" title="Permalink to this headline">¶</a></h2>
<p>Let’s read in the famous Titanic data set and split it into training and test sets:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../../examples/dummy_data/titanic.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;PassengerId&#39;</span><span class="p">)</span>
<span class="n">target_col</span> <span class="o">=</span> <span class="s1">&#39;Survived&#39;</span>
<span class="n">cols_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Ticket&#39;</span><span class="p">,</span> <span class="s1">&#39;Cabin&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="n">target_col</span><span class="p">]</span> <span class="o">+</span> <span class="n">cols_to_drop</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X_train_raw</span><span class="p">,</span> <span class="n">X_test_raw</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="n">test_size</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Data-processing">
<h2>Data processing<a class="headerlink" href="#Data-processing" title="Permalink to this headline">¶</a></h2>
<p>Let’s apply the following simple steps to process the data: * One hot encode categorical variables (accounting for nulls) * Impute numeric features with -1</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># OHE</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span>
    <span class="n">use_cat_names</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_raw</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_raw</span><span class="p">)</span>

<span class="c1"># Impute</span>
<span class="n">X_train</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X_test</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/jlaidler/venvs/iguanas_dev/lib/python3.8/site-packages/category_encoders/utils.py:21: FutureWarning: is_categorical is deprecated and will be removed in a future version.  Use is_categorical_dtype instead
  elif pd.api.types.is_categorical(cols):
</pre></div></div>
</div>
<hr class="docutils" />
</section>
<section id="Set-up-pipeline">
<h2>Set up pipeline<a class="headerlink" href="#Set-up-pipeline" title="Permalink to this headline">¶</a></h2>
<p>To create the worflow shown at the beginning of the notebook, let’s first assume we have the following existing rule set (stored in the standard Iguanas string format):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">existing_rules</span> <span class="o">=</span> <span class="n">Rules</span><span class="p">(</span>
    <span class="n">rule_strings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;AgeRule&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;Age&#39;]&gt;20)|(X[&#39;Age&#39;].isna())&quot;</span><span class="p">,</span>
        <span class="s1">&#39;CombinedRule&#39;</span><span class="p">:</span> <span class="s2">&quot;(X[&#39;Pclass&#39;]&lt;=2)&amp;(X[&#39;Sex&#39;]==&#39;female&#39;)&quot;</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>Note:</strong> these rules use the unprocessed data, as they contain conditions that either look for null values or compare to a given category. We’ll need to use the unprocessed data when optimising these rules.</p>
<p>To use in a rule optimiser, we need to convert the rules to the standard Iguanas lambda expression format:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">existing_rule_lambdas</span> <span class="o">=</span> <span class="n">existing_rules</span><span class="o">.</span><span class="n">as_rule_lambdas</span><span class="p">(</span>
    <span class="n">as_numpy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">with_kwargs</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now let’s instantiate the classes used in our Parallel Pipeline - this will consist of a rule generation step and a rule optimisation step. We’ll optimise both our rules and our decision engine to maximise the <strong>F1 score</strong>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Optimisation metric</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">FScore</span><span class="p">(</span><span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Rule generation</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">RuleGeneratorDT</span><span class="p">(</span>
    <span class="n">metric</span><span class="o">=</span><span class="n">f1</span><span class="o">.</span><span class="n">fit</span><span class="p">,</span>
    <span class="n">n_total_conditions</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">tree_ensemble</span><span class="o">=</span><span class="n">RandomForestClassifier</span><span class="p">(</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">),</span>
    <span class="n">target_feat_corr_types</span><span class="o">=</span><span class="s1">&#39;Infer&#39;</span>
<span class="p">)</span>
<span class="c1"># Rule optimisation</span>
<span class="n">optimiser</span> <span class="o">=</span> <span class="n">BayesianOptimiser</span><span class="p">(</span>
    <span class="n">rule_lambdas</span><span class="o">=</span><span class="n">existing_rule_lambdas</span><span class="p">,</span>
    <span class="n">lambda_kwargs</span><span class="o">=</span><span class="n">existing_rules</span><span class="o">.</span><span class="n">lambda_kwargs</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="n">f1</span><span class="o">.</span><span class="n">fit</span><span class="p">,</span>
    <span class="n">n_iter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now we can create the steps of our Parallel Pipeline. Each step should be a tuple of two elements:</p>
<ol class="arabic simple">
<li><p>The first element should be a string which refers to the step.</p></li>
<li><p>The second element should be the instantiated class which runs at that step.</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">steps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;generator&#39;</span><span class="p">,</span> <span class="n">generator</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;optimiser&#39;</span><span class="p">,</span> <span class="n">optimiser</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<p>Then we can instantiate our Parallel Pipeline:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Instantiate the ParallelPipeline</span>
<span class="n">pp</span> <span class="o">=</span> <span class="n">ParallelPipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span> <span class="c1"># Set to 1 to see overall progress</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now that we have our Parallel Pipeline defined, we can define our Linear Pipeline, the first step of which will be our Parallel Pipeline. This will run the rule generation and optimisation steps separately, combine their outputs, and feed it into the decision engine optimiser (our second step in the Linear Pipeline):</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Decision engine (to be optimised)</span>
<span class="n">rbs_pipeline</span> <span class="o">=</span> <span class="n">RBSPipeline</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="p">[],</span> <span class="c1"># Use an empty list here - the RBSOptimiser will create the config</span>
    <span class="n">final_decision</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="c1"># Decision engine optimiser</span>
<span class="n">rbs_optimiser</span> <span class="o">=</span> <span class="n">RBSOptimiser</span><span class="p">(</span>
    <span class="n">pipeline</span><span class="o">=</span><span class="n">rbs_pipeline</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="n">f1</span><span class="o">.</span><span class="n">fit</span><span class="p">,</span>
    <span class="n">pos_pred_rules</span><span class="o">=</span><span class="n">ClassAccessor</span><span class="p">(</span>
        <span class="n">class_tag</span><span class="o">=</span><span class="s1">&#39;pp&#39;</span><span class="p">,</span>
        <span class="n">class_attribute</span><span class="o">=</span><span class="s1">&#39;rule_names&#39;</span>
    <span class="p">),</span>
    <span class="n">rules</span><span class="o">=</span><span class="n">ClassAccessor</span><span class="p">(</span>
        <span class="n">class_tag</span><span class="o">=</span><span class="s1">&#39;pp&#39;</span><span class="p">,</span>
        <span class="n">class_attribute</span><span class="o">=</span><span class="s1">&#39;rules&#39;</span>
    <span class="p">),</span>
    <span class="n">n_iter</span><span class="o">=</span><span class="mi">20</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>Note:</strong> The arguments passed to the <code class="docutils literal notranslate"><span class="pre">pos_pred_rules</span></code> and <code class="docutils literal notranslate"><span class="pre">rules</span></code> parameters in the <code class="docutils literal notranslate"><span class="pre">RBSOptimiser</span></code> class are <code class="docutils literal notranslate"><span class="pre">ClassAccessor</span></code> objects. This object extracts the specified attribute from the given class in the pipeline. This allows users to pass attributes from earlier steps in the pipeline as parameters of later steps in the pipeline.</p>
<p>In this example, the names of the rules that are present in the concatenated output produced by the <code class="docutils literal notranslate"><span class="pre">ParallelPipeline</span></code> are passed to the <code class="docutils literal notranslate"><span class="pre">pos_pred_rules</span></code> parameter of the <code class="docutils literal notranslate"><span class="pre">RBSOptimiser</span></code> class - this is so the <code class="docutils literal notranslate"><span class="pre">RBSOptimiser</span></code> knows which rules predict positive cases (which, one might argue, doesn’t need to be specified in this example, as we only have one type of rule set. However, when you have a set of rules - some that predict positive cases and some that predict negative cases - you
must specify which rules predict what case, using the <code class="docutils literal notranslate"><span class="pre">pos_pred_rules</span></code> and <code class="docutils literal notranslate"><span class="pre">neg_pred_rules</span></code> parameters).</p>
<p>Also, the <code class="docutils literal notranslate"><span class="pre">rules</span></code> attribute created in the <code class="docutils literal notranslate"><span class="pre">ParallelPipeline</span></code> are passed to the <code class="docutils literal notranslate"><span class="pre">rules</span></code> parameter of the <code class="docutils literal notranslate"><span class="pre">RBSOptimiser</span></code> class. This is so the rules remaining after the decision engine optimisation can be easily extracted from the trained pipeline.</p>
<p>Now we can define the steps of our Linear Pipeline:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;pp&#39;</span><span class="p">,</span> <span class="n">pp</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;rbs_optimiser&#39;</span><span class="p">,</span> <span class="n">rbs_optimiser</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<p>Finally, we can instantiate our Linear Pipeline:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Instatiate the LinearPipeline</span>
<span class="n">lp</span> <span class="o">=</span> <span class="n">LinearPipeline</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span> <span class="c1"># Set to 2 to see current step being trained</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Using-the-pipeline">
<h2>Using the pipeline<a class="headerlink" href="#Using-the-pipeline" title="Permalink to this headline">¶</a></h2>
<section id="fit-method">
<h3><code class="docutils literal notranslate"><span class="pre">fit</span></code> method<a class="headerlink" href="#fit-method" title="Permalink to this headline">¶</a></h3>
<p>By running the <code class="docutils literal notranslate"><span class="pre">fit</span></code> method, we sequentially run the <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code> methods of each step in the pipeline, except for the last step, where the <code class="docutils literal notranslate"><span class="pre">fit</span></code> method is run.</p>
<p><strong>Note:</strong> we need to pass the unprocessed data to the rule optimiser step - we can do this by feeding a dictionary to the parameter <code class="docutils literal notranslate"><span class="pre">X</span></code>, where the key of the dictionary corresponds to the step where the given dataset (value) should be passed:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">X</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;generator&#39;</span><span class="p">:</span> <span class="n">X_train</span><span class="p">,</span>
        <span class="s1">&#39;optimiser&#39;</span><span class="p">:</span> <span class="n">X_train_raw</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span>
    <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--- Applying `fit_transform` method for step `pp` ---
100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2/2 [00:00&lt;00:00, 19.23it/s]
--- Applying `fit` method or step `rbs_optimiser` ---
</pre></div></div>
</div>
<section id="Outputs">
<h4>Outputs<a class="headerlink" href="#Outputs" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">fit</span></code> method doesn’t return anything. However, you can access the attributes of the fitted classes using the <code class="docutils literal notranslate"><span class="pre">get_params</span></code> method.</p>
<p>To see the rules that remain after the decision engine optimisation, we can extract the <code class="docutils literal notranslate"><span class="pre">rules</span></code> attribute from the <code class="docutils literal notranslate"><span class="pre">rbs_optimiser</span></code> step in the trained pipeline:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span> <span class="o">=</span> <span class="n">lp</span><span class="o">.</span><span class="n">get_params</span><span class="p">()[</span><span class="s1">&#39;rbs_optimiser&#39;</span><span class="p">][</span><span class="s1">&#39;rules&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Then access the <code class="docutils literal notranslate"><span class="pre">rule_strings</span></code> attribute to see the logic of each rule:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rules</span><span class="o">.</span><span class="n">rule_strings</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;RGDT_Rule_20220221_1&#39;: &#34;(X[&#39;Embarked_Q&#39;]==True)&amp;(X[&#39;Embarked_S&#39;]==False)&amp;(X[&#39;Sex_female&#39;]==True)&#34;,
 &#39;CombinedRule&#39;: &#34;(X[&#39;Pclass&#39;]&lt;=2)&amp;(X[&#39;Sex&#39;]==&#39;female&#39;)&#34;}
</pre></div></div>
</div>
</section>
</section>
<section id="fit_predict-method">
<h3><code class="docutils literal notranslate"><span class="pre">fit_predict</span></code> method<a class="headerlink" href="#fit_predict-method" title="Permalink to this headline">¶</a></h3>
<p>By running the <code class="docutils literal notranslate"><span class="pre">fit_predict</span></code> method, we sequentially run the <code class="docutils literal notranslate"><span class="pre">fit_transform</span></code> methods of each step in the pipeline, except for the last step, where the <code class="docutils literal notranslate"><span class="pre">fit_predict</span></code> method is run.</p>
<p><strong>Note:</strong> we need to pass the unprocessed data to the rule optimiser step - we can do this by feeding a dictionary to the parameter <code class="docutils literal notranslate"><span class="pre">X</span></code>, where the key of the dictionary corresponds to the step where the given dataset (value) should be passed:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_pred_train</span> <span class="o">=</span> <span class="n">lp</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span>
    <span class="n">X</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;generator&#39;</span><span class="p">:</span> <span class="n">X_train</span><span class="p">,</span>
        <span class="s1">&#39;optimiser&#39;</span><span class="p">:</span> <span class="n">X_train_raw</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span>
    <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--- Applying `fit_transform` method for step `pp` ---
100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2/2 [00:00&lt;00:00, 23.22it/s]
--- Applying `fit` method or step `rbs_optimiser` ---
</pre></div></div>
</div>
<section id="id1">
<h4>Outputs<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">fit_predict</span></code> method returns the prediction generated by class in the final step of the pipeline - in this case, the <code class="docutils literal notranslate"><span class="pre">RBSOptimiser</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_pred_train</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PassengerId
7      0
719    0
686    0
74     0
883    0
      ..
107    0
271    0
861    0
436    1
103    0
Length: 596, dtype: int64
</pre></div></div>
</div>
</section>
</section>
<section id="predict-method">
<h3><code class="docutils literal notranslate"><span class="pre">predict</span></code> method<a class="headerlink" href="#predict-method" title="Permalink to this headline">¶</a></h3>
<p>By running the <code class="docutils literal notranslate"><span class="pre">predict</span></code> method, we sequentially run the <code class="docutils literal notranslate"><span class="pre">transform</span></code> methods of each step in the pipeline, except for the last step, where the <code class="docutils literal notranslate"><span class="pre">predict</span></code> method is run. Note that before using this method, you should first run either the <code class="docutils literal notranslate"><span class="pre">fit</span></code> or <code class="docutils literal notranslate"><span class="pre">fit_predict</span></code> methods:</p>
<p><strong>Note:</strong> we need to pass the unprocessed data to the rule optimiser step - we can do this by feeding a dictionary to the parameter <code class="docutils literal notranslate"><span class="pre">X</span></code>, where the key of the dictionary corresponds to the step where the given dataset (value) should be passed:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_pred_test</span> <span class="o">=</span> <span class="n">lp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">X</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;generator&#39;</span><span class="p">:</span> <span class="n">X_test</span><span class="p">,</span>
        <span class="s1">&#39;optimiser&#39;</span><span class="p">:</span> <span class="n">X_test_raw</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<section id="id2">
<h4>Outputs<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">predict</span></code> method returns the prediction generated by class in the final step of the pipeline - in this case, the <code class="docutils literal notranslate"><span class="pre">RBSOptimiser</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_pred_test</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PassengerId
710    0
440    0
841    0
721    1
40     0
      ..
716    0
526    0
382    0
141    0
174    0
Length: 295, dtype: int64
</pre></div></div>
</div>
<p>This approach is very powerful when optimising hyperparameters for the overall performance of a Rules-Based System - see the <code class="docutils literal notranslate"><span class="pre">BayesSearchCV</span></code> class in the <code class="docutils literal notranslate"><span class="pre">rule_selection</span></code> module for more information.</p>
<hr class="docutils" />
</section>
</section>
</section>
</section>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, James Laidler.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>